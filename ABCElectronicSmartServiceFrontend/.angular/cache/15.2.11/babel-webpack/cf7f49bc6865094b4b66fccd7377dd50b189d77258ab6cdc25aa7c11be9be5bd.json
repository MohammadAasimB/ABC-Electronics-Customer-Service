{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { jwtDecode } from 'jwt-decode';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.loggedIn = new BehaviorSubject(this.hasToken());\n    this.roles = new BehaviorSubject(this.getRolesFromToken());\n    this.isLoggedIn$ = this.loggedIn.asObservable();\n    this.roles$ = this.roles.asObservable();\n  }\n  hasToken() {\n    return !!localStorage.getItem('jwtToken');\n  }\n  getRolesFromToken() {\n    const token = localStorage.getItem('jwtToken');\n    if (!token) return [];\n    try {\n      const decoded = jwtDecode(token);\n      return decoded.roles || [];\n    } catch {\n      return [];\n    }\n  }\n  getToken() {\n    return localStorage.getItem('jwtToken');\n  }\n  getUserRoles() {\n    // console.log('rol' + this.roles.value);\n    return this.roles.value;\n  }\n  getUsername() {\n    const token = this.getToken();\n    if (!token) return null;\n    try {\n      const decoded = jwtDecode(token);\n      return decoded.sub;\n    } catch {\n      return null;\n    }\n  }\n  isRole(role) {\n    return this.getUserRoles().includes(role);\n  }\n  isLoggedIn() {\n    return this.loggedIn.value;\n  }\n  login(token) {\n    localStorage.setItem('jwtToken', token);\n    this.loggedIn.next(true);\n    this.roles.next(this.getRolesFromToken());\n    console.log('->' + localStorage.getItem('jwtToken'));\n    console.log('Decoded Token:', jwtDecode(token));\n    console.log('role:', jwtDecode(token).roles || []);\n  }\n  logout() {\n    localStorage.removeItem('jwtToken');\n    this.loggedIn.next(false);\n    this.roles.next([]);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"AACA,SAASA,eAAe,QAAQ,MAAM;AACtC,SAASC,SAAS,QAAQ,YAAY;;AAWtC,OAAM,MAAOC,WAAW;EAHxBC;IAIU,aAAQ,GAAG,IAAIH,eAAe,CAAU,IAAI,CAACI,QAAQ,EAAE,CAAC;IACxD,UAAK,GAAG,IAAIJ,eAAe,CAAW,IAAI,CAACK,iBAAiB,EAAE,CAAC;IAEvE,gBAAW,GAAG,IAAI,CAACC,QAAQ,CAACC,YAAY,EAAE;IAC1C,WAAM,GAAG,IAAI,CAACC,KAAK,CAACD,YAAY,EAAE;;EAE1BH,QAAQ;IACd,OAAO,CAAC,CAACK,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;EAC3C;EAEQL,iBAAiB;IACvB,MAAMM,KAAK,GAAGF,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;IAC9C,IAAI,CAACC,KAAK,EAAE,OAAO,EAAE;IACrB,IAAI;MACF,MAAMC,OAAO,GAAGX,SAAS,CAAeU,KAAK,CAAC;MAC9C,OAAOC,OAAO,CAACJ,KAAK,IAAI,EAAE;KAC3B,CAAC,MAAM;MACN,OAAO,EAAE;;EAEb;EAEAK,QAAQ;IACN,OAAOJ,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;EACzC;EAEAI,YAAY;IACV;IACA,OAAO,IAAI,CAACN,KAAK,CAACO,KAAK;EACzB;EAEAC,WAAW;IACT,MAAML,KAAK,GAAG,IAAI,CAACE,QAAQ,EAAE;IAC7B,IAAI,CAACF,KAAK,EAAE,OAAO,IAAI;IACvB,IAAI;MACF,MAAMC,OAAO,GAAGX,SAAS,CAAeU,KAAK,CAAC;MAC9C,OAAOC,OAAO,CAACK,GAAG;KACnB,CAAC,MAAM;MACN,OAAO,IAAI;;EAEf;EAEAC,MAAM,CAACC,IAAY;IACjB,OAAO,IAAI,CAACL,YAAY,EAAE,CAACM,QAAQ,CAACD,IAAI,CAAC;EAC3C;EAEAE,UAAU;IACR,OAAO,IAAI,CAACf,QAAQ,CAACS,KAAK;EAC5B;EAEAO,KAAK,CAACX,KAAa;IACjBF,YAAY,CAACc,OAAO,CAAC,UAAU,EAAEZ,KAAK,CAAC;IACvC,IAAI,CAACL,QAAQ,CAACkB,IAAI,CAAC,IAAI,CAAC;IACxB,IAAI,CAAChB,KAAK,CAACgB,IAAI,CAAC,IAAI,CAACnB,iBAAiB,EAAE,CAAC;IACzCoB,OAAO,CAACC,GAAG,CAAC,IAAI,GAAGjB,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,CAAC;IACpDe,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEzB,SAAS,CAAeU,KAAK,CAAC,CAAC;IAC7Dc,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEzB,SAAS,CAAeU,KAAK,CAAC,CAACH,KAAK,IAAI,EAAE,CAAC;EAClE;EAEAmB,MAAM;IACJlB,YAAY,CAACmB,UAAU,CAAC,UAAU,CAAC;IACnC,IAAI,CAACtB,QAAQ,CAACkB,IAAI,CAAC,KAAK,CAAC;IACzB,IAAI,CAAChB,KAAK,CAACgB,IAAI,CAAC,EAAE,CAAC;EACrB;;;uBA/DWtB,WAAW;IAAA;EAAA;;;aAAXA,WAAW;MAAA2B,SAAX3B,WAAW;MAAA4B,YAFV;IAAM;EAAA","names":["BehaviorSubject","jwtDecode","AuthService","constructor","hasToken","getRolesFromToken","loggedIn","asObservable","roles","localStorage","getItem","token","decoded","getToken","getUserRoles","value","getUsername","sub","isRole","role","includes","isLoggedIn","login","setItem","next","console","log","logout","removeItem","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\MB20\\OneDrive - Capgemini\\Desktop\\New folder (4)\\ABC-Electronics-Customer-Service\\ABCElectronicSmartServiceFrontend\\src\\app\\service\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { jwtDecode } from 'jwt-decode';\n\ninterface MyJwtPayload {\n  sub: string;\n  roles: string[];\n  exp: number;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class AuthService {\n  private loggedIn = new BehaviorSubject<boolean>(this.hasToken());\n  private roles = new BehaviorSubject<string[]>(this.getRolesFromToken());\n\n  isLoggedIn$ = this.loggedIn.asObservable();\n  roles$ = this.roles.asObservable();\n\n  private hasToken(): boolean {\n    return !!localStorage.getItem('jwtToken');\n  }\n\n  private getRolesFromToken(): string[] {\n    const token = localStorage.getItem('jwtToken');\n    if (!token) return [];\n    try {\n      const decoded = jwtDecode<MyJwtPayload>(token);\n      return decoded.roles || [];\n    } catch {\n      return [];\n    }\n  }\n\n  getToken(): string | null {\n    return localStorage.getItem('jwtToken');\n  }\n\n  getUserRoles(): string[] {\n    // console.log('rol' + this.roles.value);\n    return this.roles.value;\n  }\n\n  getUsername(): string | null {\n    const token = this.getToken();\n    if (!token) return null;\n    try {\n      const decoded = jwtDecode<MyJwtPayload>(token);\n      return decoded.sub;\n    } catch {\n      return null;\n    }\n  }\n\n  isRole(role: string): boolean {\n    return this.getUserRoles().includes(role);\n  }\n\n  isLoggedIn(): boolean {\n    return this.loggedIn.value;\n  }\n\n  login(token: string): void {\n    localStorage.setItem('jwtToken', token);\n    this.loggedIn.next(true);\n    this.roles.next(this.getRolesFromToken());\n    console.log('->' + localStorage.getItem('jwtToken'));\n    console.log('Decoded Token:', jwtDecode<MyJwtPayload>(token));\n    console.log('role:', jwtDecode<MyJwtPayload>(token).roles || []);\n  }\n\n  logout(): void {\n    localStorage.removeItem('jwtToken');\n    this.loggedIn.next(false);\n    this.roles.next([]);\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}